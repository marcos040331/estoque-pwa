<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0B1220" />
  <title>Estoque Pro (Offline)</title>
  <link rel="manifest" href="./manifest.json">
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">EP</div>
      <div>
        <div class="brand-title">Estoque Pro</div>
        <div class="brand-sub">Offline ‚Ä¢ PWA ‚Ä¢ CRUD</div>
      </div>
    </div>

    <div class="top-actions">
      <button id="btnConfig" class="btn ghost" type="button" title="Configura√ß√µes">Config</button>
      <button id="btnGroups" class="btn ghost" type="button" title="Gerenciar grupos">Grupos</button>
      <button id="btnMoves" class="btn ghost" type="button" title="Movimenta√ß√µes">Movs</button>

      <button id="btnExportCSV" class="btn ghost" type="button" title="Exportar CSV">CSV</button>
      <label class="btn ghost file" title="Importar CSV (itens)">
        Importar CSV
        <input id="fileImportCSV" type="file" accept=".csv,text/csv">
      </label>

      <button id="btnBackup" class="btn ghost" type="button" title="Exportar backup (.json)">Backup</button>
      <label class="btn ghost file" title="Importar backup (.json)">
        Restaurar
        <input id="fileRestore" type="file" accept="application/json">
      </label>
    </div>
  </header>

  <main class="container">
    <section class="kpis">
      <div class="kpi-card">
        <div class="kpi-title">Itens</div>
        <div id="kpiItens" class="kpi-value">0</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-title">Quantidade total</div>
        <div id="kpiQtd" class="kpi-value">0</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-title">Baixo estoque</div>
        <div id="kpiBaixo" class="kpi-value warn">0</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-title">Valor estimado</div>
        <div id="kpiValor" class="kpi-value">R$ 0,00</div>
      </div>
    </section>

    <section id="lowPanel" class="panel subtle hidden">
      <div class="panel-header">
        <div class="panel-title">
          <span class="dot warn"></span>
          Itens com baixo estoque
          <span id="lowCount" class="chip">0</span>
        </div>
        <div class="filters">
          <button id="btnNotif" class="btn ghost" type="button" title="Notifica√ß√µes de baixo estoque">Notifica√ß√µes</button>
        </div>
      </div>
      <div id="lowList" class="lowlist"></div>
    </section>

    <section class="panel">
      <div class="panel-header">
        <div class="searchbox">
          <span class="icon">üîé</span>
          <input id="search" class="input bare" type="text" placeholder="Buscar por grupo, modelo, nome, local ou descri√ß√£o‚Ä¶">
          <button id="btnSearch" class="iconbtn" type="button" title="Buscar (igual Enter)">‚Üµ</button>
        </div>

        <div class="filters">
          <select id="groupFilter" class="input select" title="Filtrar por grupo">
            <!-- options via JS -->
          </select>

          <button id="btnSort" class="btn ghost" type="button" title="Alternar ordena√ß√£o">
            Ordenar: <span id="sortLabel">Baixo estoque</span>
          </button>
          <button id="btnOnlyLow" class="btn ghost" type="button" title="Mostrar s√≥ baixo estoque">
            <span id="onlyLowLabel">Todos</span>
          </button>
        </div>
      </div>

      <div class="hint">
        Dica: digite e aperte <b>Enter</b> (ou bot√£o ‚Üµ) para abrir o primeiro resultado.
        Toque em <b>-1</b> quando vender e <b>+1</b> quando repor. Clique no card para editar.
      </div>

      <ul id="list" class="grid"></ul>
    </section>
  </main>

  <button id="fabAdd" class="fab" type="button" aria-label="Adicionar item">Ôºã</button>

  <!-- Modal Item -->
  <div id="modal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-titlebar">
        <div>
          <div id="modalTitle" class="modal-title">Novo item</div>
          <div id="modalSubtitle" class="modal-subtitle">Cadastro r√°pido</div>
        </div>
        <button id="btnClose" class="btn ghost" type="button" aria-label="Fechar">‚úï</button>
      </div>

      <form id="form" class="form">
        <input type="hidden" id="itemId" />

        <div class="grid3">
          <div>
            <label class="label">Grupo</label>
            <select id="grupo" class="input select"></select>
            <div class="minihelp">Use ‚Äú+ Novo grupo‚Ä¶‚Äù no final da lista.</div>
          </div>
          <div>
            <label class="label">Modelo / Varia√ß√£o (opcional)</label>
            <input id="modelo" class="input" type="text" placeholder="Ex: 20cm / Preto / iPhone 11" />
          </div>
          <div>
            <label class="label">Nome</label>
            <input id="nome" class="input" type="text" placeholder="Ex: Cabo USB / Mouse / Parafuso" required />
          </div>
        </div>

        <div class="grid2">
          <div>
            <label class="label">Local (opcional)</label>
            <input id="local" class="input" type="text" placeholder="Ex: Caixa 3 / Gaveta A / Prateleira 2" />
          </div>
          <div>
            <label class="label">Foto (opcional)</label>
            <div class="photo-row">
              <label class="btn ghost file">
                Enviar foto
                <input id="fotoFile" type="file" accept="image/*" capture="environment">
              </label>
              <button id="btnClearFoto" class="btn ghost" type="button">Remover</button>
              <span id="fotoStatus" class="minihelp">Sem foto</span>
            </div>
          </div>
        </div>

        <label class="label">Descri√ß√£o (opcional)</label>
        <input id="descricao" class="input" type="text" placeholder="Observa√ß√µes, c√≥digo interno..." />

        <div class="grid3">
          <div>
            <label class="label">Valor (R$) ‚Äî opcional</label>
            <input id="valor" class="input" type="number" step="0.01" min="0" placeholder="Ex: 25.00" />
          </div>
          <div>
            <label class="label">Quantidade</label>
            <input id="quantidade" class="input" type="number" step="1" min="0" placeholder="0" required />
          </div>
          <div>
            <label class="label">Baixo estoque (limite)</label>
            <input id="limite" class="input" type="number" step="1" min="0" placeholder="2" />
          </div>
        </div>

        <div class="row end">
          <button id="btnDelete" class="btn danger hidden" type="button">Excluir</button>
          <button class="btn ghost" type="button" id="btnCancel">Cancelar</button>
          <button class="btn primary" type="submit">Salvar</button>
        </div>
      </form>

      <div class="modal-footer split">
        <div class="left">
          <button id="btnHistory" class="btn ghost" type="button">Hist√≥rico</button>
        </div>
        <div class="right">
          <button id="btnMinus" class="btn ghost" type="button">-1 Venda</button>
          <button id="btnPlus" class="btn ghost" type="button">+1 Repor</button>
        </div>
      </div>

      <div id="historyBox" class="history hidden">
        <div class="history-head">
          <div class="panel-title"><span class="dot"></span> Movimenta√ß√µes do item</div>
          <button id="btnHistoryClose" class="btn ghost" type="button">Fechar</button>
        </div>
        <div class="row">
          <input id="moveNote" class="input" type="text" placeholder="Observa√ß√£o r√°pida (ex: venda balc√£o / reposi√ß√£o)" />
          <button id="btnAddVenda" class="btn danger" type="button">Registrar venda (-1)</button>
          <button id="btnAddRepo" class="btn primary" type="button">Registrar reposi√ß√£o (+1)</button>
        </div>
        <div id="historyList" class="history-list"></div>
      </div>
    </div>
  </div>

  <!-- Modal Grupos -->
  <div id="groupsModal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-titlebar">
        <div>
          <div class="modal-title">Grupos</div>
          <div class="modal-subtitle">Criar, renomear, excluir</div>
        </div>
        <button id="btnGroupsClose" class="btn ghost" type="button" aria-label="Fechar">‚úï</button>
      </div>

      <div class="form">
        <div class="row">
          <input id="groupNewName" class="input" type="text" placeholder="Novo grupo (ex: Ferramentas, Inform√°tica)" />
          <button id="btnGroupAdd" class="btn primary" type="button">Adicionar</button>
        </div>

        <div class="minihelp">
          Excluir um grupo move os itens dele para ‚ÄúSem grupo‚Äù.
        </div>

        <div id="groupsList" class="groups-list"></div>

        <div class="row end">
          <button id="btnGroupsOk" class="btn ghost" type="button">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Movimenta√ß√µes (geral) -->
  <div id="movesModal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-titlebar">
        <div>
          <div class="modal-title">Movimenta√ß√µes</div>
          <div class="modal-subtitle">√öltimas opera√ß√µes (vendas/reposi√ß√µes)</div>
        </div>
        <button id="btnMovesClose" class="btn ghost" type="button" aria-label="Fechar">‚úï</button>
      </div>

      <div class="form">
        <div class="row">
          <button id="btnMovesCSV" class="btn ghost" type="button">Exportar movs CSV</button>
          <button id="btnMovesClear" class="btn danger" type="button">Limpar hist√≥rico</button>
        </div>
        <div id="movesList" class="history-list"></div>

        <div class="row end">
          <button id="btnMovesOk" class="btn ghost" type="button">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Config -->
  <div id="configModal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-titlebar">
        <div>
          <div class="modal-title">Configura√ß√µes</div>
          <div class="modal-subtitle">Seguran√ßa e notifica√ß√µes</div>
        </div>
        <button id="btnConfigClose" class="btn ghost" type="button" aria-label="Fechar">‚úï</button>
      </div>

      <div class="form">
        <div class="panel subtle">
          <div class="panel-header">
            <div class="panel-title"><span class="dot"></span> Bloqueio por PIN</div>
          </div>
          <div class="row">
            <input id="pinNew" class="input" type="password" inputmode="numeric" placeholder="Novo PIN (4 a 8 d√≠gitos)" />
            <button id="btnSetPin" class="btn primary" type="button">Salvar PIN</button>
            <button id="btnRemovePin" class="btn danger" type="button">Remover PIN</button>
          </div>
          <div class="minihelp">Se voc√™ definir um PIN, o app vai pedir o PIN ao abrir.</div>
        </div>

        <div class="panel subtle">
          <div class="panel-header">
            <div class="panel-title"><span class="dot warn"></span> Notifica√ß√µes</div>
          </div>
          <div class="row">
            <button id="btnEnableNotif" class="btn ghost" type="button">Ativar permiss√µes</button>
            <button id="btnTestNotif" class="btn ghost" type="button">Testar notifica√ß√£o</button>
          </div>
          <div class="minihelp">As notifica√ß√µes funcionam melhor quando instalado como app (PWA).</div>
        </div>

        <div class="row end">
          <button id="btnConfigOk" class="btn ghost" type="button">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Lock Screen -->
  <div id="lock" class="lock hidden" aria-hidden="true">
    <div class="lock-card">
      <div class="lock-title">Estoque Pro</div>
      <div class="lock-sub">Digite seu PIN para entrar</div>
      <input id="pinInput" class="input" type="password" inputmode="numeric" placeholder="PIN" />
      <button id="btnUnlock" class="btn primary" type="button">Entrar</button>
      <div id="lockMsg" class="minihelp"></div>
    </div>
  </div>

  <script src="./app.js"></script>
</body>
</html>
